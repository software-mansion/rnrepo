name: Publish RNRepo Gradle Plugin for Android

run-name: Publish RNRepo Gradle Plugin for Android

on:
  workflow_dispatch:
    inputs:
      snapshot:
        description: 'Publish as snapshot version to /snapshots repository'
        required: false
        type: boolean
        default: false

jobs:
  build-rnrepo-plugin-android:
    runs-on: rnrepo-ubuntu-latest

    steps:
      - name: üèó Checkout repository
        uses: actions/checkout@v4

      - name: üî® Build RNRepo Gradle Plugin for Android
        run: ./gradlew build
        working-directory: ./packages/client/rnrepo-plugin

      - name: üì¶ Publish RNRepo Gradle Plugin for Android
        run: |
          ./gradlew publishReleasePublicationToRnrepoRepository --no-daemon \
          -PmavenUsername=${{ secrets.RNREPO_SWM_PUBLISHER_USERNAME }} \
          -PmavenPassword=${{ secrets.RNREPO_SWM_PUBLISHER_TOKEN }} \
          -PmavenRepositoryUrl=${{ format('{0}{1}', secrets.RNREPO_SWM_REPOSITORY_URL_BASE, inputs.snapshot && '/snapshots' || '/releases') }} \
          -PsigningKey="${{ secrets.GPG_PRIVATE_KEY }}" \
          -PsigningPassword="${{ secrets.GPG_PASSPHRASE }}"
        working-directory: ./packages/client/rnrepo-plugin
