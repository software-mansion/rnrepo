name: Daily React Native Version Check

on:
  schedule:
    # Run every day at 2 AM UTC
    - cron: '0 2 * * *'
  # Allow manual trigger from GitHub UI
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  check-react-native-version:
    runs-on: rnrepo-ubuntu-latest
    name: Check for new React Native versions

    steps:
      - name: ðŸ— Checkout code
        uses: actions/checkout@v4

      - name: ðŸ— Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: ðŸ—ƒï¸ Cache Bun dependencies
        uses: actions/cache@v4
        with:
          path: ~/.bun/install/cache
          key: ${{ runner.os }}-bun-${{ hashFiles('**/bun.lock') }}
          restore-keys: |
            ${{ runner.os }}-bun-

      - name: ðŸ“¦ Install dependencies
        run: bun install

      - name: ðŸ” Check and update React Native versions
        run: bun run packages/scheduler/src/update-react-native-versions.ts

      - name: ðŸ”§ Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: ðŸ“¤ Check changes
        run: |
          if git diff --quiet react-native-versions.json; then
            echo "No changes to commit"
          else
            echo "HAS_CHANGES=true" >> $GITHUB_ENV
          fi

      - name: ðŸ”„ Create or update Pull Request
        if: env.HAS_CHANGES == 'true'
        uses: peter-evans/create-pull-request@v8
        with:
          base: main
          add-paths: react-native-versions.json
          branch: chore/update-react-native-versions
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "[BOT] Update React Native versions"
          title: "[BOT] Update React Native versions"
          body: |
            ## ðŸš€ React Native Version Update
            
            This PR updates the React Native versions list with newly released versions.
            
            _This is an automated PR generated by the daily version check workflow._
          delete-branch: true
