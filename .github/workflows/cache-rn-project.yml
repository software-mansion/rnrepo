name: Cache RN Project

run-name: Cache RN project for RN@${{ inputs.react_native_version }}

on:
  workflow_dispatch:
    inputs:
      react_native_version:
        description: 'React Native version'
        required: true
        type: string

jobs:
  cache-rn-project:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - rnrepo-builder-ubuntu-latest
          - macos-latest
    timeout-minutes: 60

    steps:
      - name: ğŸ— Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ— Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ“± Create RN project
        run: |
          work_dir="${{ runner.temp }}"
          mkdir -p "$work_dir"
          cd "$work_dir"
          bunx @react-native-community/cli@latest init rnrepo_build_app --version "${{ inputs.react_native_version }}" --skip-install
          cd "$work_dir/rnrepo_build_app"
          npm install

      - name: ğŸ“¦ Cache RN project
        uses: actions/cache@v4
        with:
          path: ${{ runner.temp }}/rnrepo_build_app
          key: ${{ runner.os }}-rn-project-cache-${{ inputs.react_native_version }}
